<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>An introduction to the curvenumber R package for the calculation of Base Flow Index and Curve Number &bull; curvenumber</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">curvenumber</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>An introduction to the curvenumber R package for the calculation of Base Flow Index and Curve Number</h1>
            
            <h4 class="date">2017-01-03</h4>
          </div>

    
    
<div class="contents">
<p>The curvenumber <span class="citation">(Vitolo and Le Vine, 2016)</span> is an R package <span class="citation">(R Core Team, 2016)</span> which allows to calculate two indices for the classification of hydrological responses: the Base Flow Index (BFI) and the Curve Number (CN). These indices are indicators of low and high flow responses, respectively. Techniques have been developed to calculate the indices for gauged and ungauged catchments in the United States <span class="citation">(Hawkins, 1993; Hjelmfelt, 1980; Rallison, 1980)</span>.</p>
<p>This work presents the first stable release of the curvenumber R package, which allows to calculate the CN and BFI empirically as well as from spatial data layers for catchments in the United Kingdom. The proposed method is based on previous investigations made by <span class="citation">Bulygina et al. (2011)</span> but sets the scene for a more general approach that can be applied globally.</p>
<p>The package contains sample datasets as well as a number of examples to test the main functionalities. The functions <code><a href="../reference/FindQevents.html">FindQevents()</a></code> and <code><a href="../reference/FindQevents.html">FindQevents()</a></code>, for instance, are used to identify rainfall-runoff events according to <span class="citation">Hjelmfelt (1980)</span>. The function <code><a href="../reference/EmpiricalCN.html">EmpiricalCN()</a></code> is used to identify the Curve Number from time series data as well as to plot the CN-P asymptotic behaviour, according to <span class="citation">Hawkins (1993)</span>. The direct storm runoff can be calulated using the function <code><a href="../reference/DirectStormRunoff.html">DirectStormRunoff()</a></code> and <code><a href="../reference/RegionalisedCN.html">RegionalisedCN()</a></code> allows to calculate the CN given soil and vegetation maps of the area. The package also allows to calculate the BFI given a soil map <code><a href="../reference/RegionalisedBFI.html">RegionalisedBFI()</a></code> and/or a time series of river discharges <code><a href="../reference/EmpiricalBFI.html">EmpiricalBFI()</a></code>.</p>
<p>Work is currently ongoing to develop the curvenumber package further and use it with a probabilistic hydrological multi-model framework <span class="citation">(Vitolo et al., 2012, 2016)</span> to predict the effects of land use changes on catchment flows.</p>
<div id="dependencies-and-installation" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#dependencies-and-installation" class="anchor"> </a></body></html>Dependencies and installation</h2>
<p>The curvenumber package, as well as the examples in the vignette, depend on a number of CRAN packages. Check for missing dependencies and install them:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">packs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"dplyr"</span>, <span class="st">"zoo"</span>, <span class="st">"tgp"</span>, <span class="st">"stats"</span>, <span class="st">"utils"</span>, <span class="st">"BH"</span>, <span class="st">"Rcpp"</span>, <span class="st">"testthat"</span>,
           <span class="st">"qualV"</span>, <span class="st">"devtools"</span>)
new.packages &lt;-<span class="st"> </span>packs[!(packs %in%<span class="st"> </span><span class="kw">installed.packages</span>()[, <span class="st">"Package"</span>])]
if(<span class="kw">length</span>(new.packages)) <span class="kw">install.packages</span>(new.packages)</code></pre></div>
<p>You can install this package from Github with <a href="https://github.com/hadley/devtools">devtools</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"cvitolo/curvenumber"</span>)</code></pre></div>
<p>Load the package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"curvenumber"</span>)</code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#usage" class="anchor"> </a></body></html>Usage</h2>
<p>For demonstration purposes, we will use data available for the Plynlimon catchments in the United Kingdom. This data is available from the <a href="https://eip.ceh.ac.uk/">Environmental Information Platform</a> hosted by the Centre for Ecology and Hydrology.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># LOAD ALL THE SAMPLE DATA</span>
<span class="co"># Look-up table for Plynlimon sub-catchments and codes</span>
<span class="kw">data</span>(<span class="st">"PlynlimonTable"</span>)
<span class="co"># Load table S1 from Bulygina et al. 2011</span>
<span class="kw">data</span>(<span class="st">"S1"</span>)
<span class="co"># Plynlimon sub-catchments spatial polygons data frame</span>
<span class="kw">data</span>(<span class="st">"PlynlimonSUBCATCHMENTS"</span>)
<span class="co"># Load time series (in mm/hour) for Plynlimon subcatchments</span>
<span class="kw">data</span>(<span class="st">"SevernTS"</span>)
SevernTS &lt;-<span class="st"> </span>SevernTS
<span class="co"># SOIL MAP (HOST percentage distribution of classes)</span>
<span class="kw">data</span>(<span class="st">"PlynlimonSOIL"</span>)
<span class="co"># LAND COVER (VEGETATION 2013) MAP</span>
<span class="kw">data</span>(<span class="st">"PlynlimonVEG"</span>)</code></pre></div>
<div id="calculated-regionalised-and-empirical-bfi" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#calculated-regionalised-and-empirical-bfi" class="anchor"> </a></body></html>Calculated regionalised and empirical BFI</h3>
<p>As Severn at Plynlimon flume is a gauged catchment, the discharge time series is avalable and can be used to calculate the empirical BFI as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/EmpiricalBFI.html">EmpiricalBFI</a></span>(<span class="dt">Qflow =</span> SevernTS$Q)
<span class="co">#&gt; [1] 0.349</span></code></pre></div>
<p>Calculate the regionalised BFI for Severn at Plynlimon flume, given a map of percentage distribution of soil classes and a lookup table.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/RegionalisedBFI.html">RegionalisedBFI</a></span>(<span class="dt">soil =</span> PlynlimonSOIL, 
                <span class="dt">catchment =</span> PlynlimonSUBCATCHMENTS[<span class="dv">1</span>,], 
                <span class="dt">lookupTable =</span> S1)
<span class="co">#&gt; [1] 0.347</span></code></pre></div>
<p>This value is not expected to diverge from the empirical value +- the weighted standard deviation of BFI, which is calculated as follows.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/StDevBFIHOST.html">StDevBFIHOST</a></span>(<span class="dt">soil =</span> PlynlimonSOIL, 
             <span class="dt">catchment =</span> PlynlimonSUBCATCHMENTS[<span class="dv">1</span>,],
             <span class="dt">lookupTable =</span> S1)
<span class="co">#&gt; [1] 0.018</span></code></pre></div>
<p>Regionalised and empirical BFI are very similar, the difference is much lower than the standard deviation.</p>
</div>
<div id="calculated-regionalised-and-empirical-cn" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#calculated-regionalised-and-empirical-cn" class="anchor"> </a></body></html>Calculated regionalised and empirical CN</h3>
<p>As Severn at Plynlimon flume is a gauged catchment, we can use the precipitation and discharge time series to calculate the empirical CN using the code below. The code takes a while to run, and the result should be 81.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/EmpiricalCN.html">EmpiricalCN</a></span>(<span class="dt">tseries =</span> SevernTS)</code></pre></div>
<p>In order to calculate the regionalised CN for Severn at Plynlimon flume, we need a vegetation map, a map of percentage distribution of soil classes and a lookup table. The lookup should be generated by the user based on the vegetation classes and hydrological condition of the region of interest. For the HOST classification, the package contains a function to generate the default lookup table, which does not take into account of the particular hydrological condition of the area:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfLookup &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MakeLoopkupTable.html">MakeLoopkupTable</a></span>()</code></pre></div>
<p>In some cases the hydrological conditions are different from the default ones. For instance, according to Bulygina et al. (2011) the Severn at Plynlimn flume catchment should have forest and pasture in good condition. The corresponding lookup table is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfLookup &lt;-<span class="st"> </span><span class="kw"><a href="../reference/MakeLoopkupTable.html">MakeLoopkupTable</a></span>(<span class="st">"Fair woods + Poor pasture"</span>)</code></pre></div>
<p>The regionalised CN can be calculated as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/RegionalisedCN.html">RegionalisedCN</a></span>(<span class="dt">soil =</span> PlynlimonSOIL,
               <span class="dt">catchment =</span> PlynlimonSUBCATCHMENTS[<span class="dv">1</span>,],
               <span class="dt">lookupTable =</span> dfLookup,
               <span class="dt">vegetation =</span> PlynlimonVEG)
<span class="co">#&gt; [1] "Calculating contribution of HOSTCODE15"</span>
<span class="co">#&gt; [1] "Calculating contribution of HOSTCODE17"</span>
<span class="co">#&gt; [1] "Calculating contribution of HOSTCODE22"</span>
<span class="co">#&gt; [1] "Calculating contribution of HOSTCODE26"</span>
<span class="co">#&gt; [1] "Calculating contribution of HOSTCODE29"</span>
<span class="co">#&gt; [1] 78</span></code></pre></div>
<p>This value is not expected to diverge from the empirical value +- 2 (standard deviation of CN), according to Bulygina et al. (2011).</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor"><html><body><a href="#references" class="anchor"> </a></body></html>References</h2>
<div id="refs" class="references">
<div id="ref-Bulygina2011">
<p>Bulygina, N., McIntyre, N. and Wheater, H.: Bayesian conditioning of a rainfall-runoff model for predicting flows in ungauged catchments and under land use changes, Water Resources Research, 47(2), 2011.</p>
</div>
<div id="ref-Hawkins1993">
<p>Hawkins, R. H.: Asymptotic determination of runoff curve numbers from data, Journal of Irrigation and Drainage Engineering, 119(2), 334&ndash;345, 1993.</p>
</div>
<div id="ref-Hjelmfelt1980">
<p>Hjelmfelt, A. T.: Empirical investigation of curve number technique, Journal of the Hydraulics Division, 106(9), 1471&ndash;1476, 1980.</p>
</div>
<div id="ref-Rbase">
<p>R Core Team: R: A language and environment for statistical computing, R Foundation for Statistical Computing, Vienna, Austria. [online] Available from: <a href="https://www.R-project.org/" class="uri">https://www.R-project.org/</a>, 2016.</p>
</div>
<div id="ref-Rallison1980">
<p>Rallison, R. E.: Origin and evolution of the scs runoff equation, in Symposium on watershed management 1980, pp. 912&ndash;924, ASCE., 1980.</p>
</div>
<div id="ref-curvenumber-archive">
<p>Vitolo, C. and Le Vine, N.: Curvenumber: An implementation of the us soil conservation service curve number method., 2016.</p>
</div>
<div id="ref-fuseGitHub">
<p>Vitolo, C., Wells, P., Dobias, M. and Buytaert, W.: Fuse: Framework for understanding structural errors., 2012.</p>
</div>
<div id="ref-fuseJOSS">
<p>Vitolo, C., Wells, P., Dobias, M. and Buytaert, W.: Fuse: An r package for ensemble hydrological modelling, The Journal of Open Source Software, 1(8), doi:<a href="https://doi.org/10.21105/joss.00052">10.21105/joss.00052</a>, 2016.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#dependencies-and-installation">Dependencies and installation</a></li>
      <li><a href="#usage">Usage</a></li>
      <li><a href="#references">References</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Claudia Vitolo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
